"use strict";(self.webpackChunkethan_desktop=self.webpackChunkethan_desktop||[]).push([[586],{4586:(k,a,s)=>{s.r(a),s.d(a,{TerminalApp:()=>M,TerminalAppModule:()=>H});var y=s(5615),u=s(1977),n=s(4650),c=s(9238),S=s(8900),g=s(9709),f=s(8898),m=s(4023);let v=(()=>{class e{constructor(t,i,r,p,o){this.EAS=t,this.toastSrv=i,this.userSrv=r,this.timeSrv=p,this.configSrv=o,this.typingHistory=[""],this.DANGER_COMMAND=["\u5371\u9669\u6307\u4ee4","null","wa$%\u53e3\u53e3\u53e3","shit","fuck","\u5783\u573e\u7cfb\u7edf","\u6211\u7231\u4f60","\u5173\u673a","shutdown","dangerous"]}pushHistory(t){for(let i=0;i<this.typingHistory.length;i++)if(this.typingHistory[i]==t){this.typingHistory.splice(i,1);break}this.typingHistory.push(t)}clearHistory(){this.typingHistory=[""]}start(t,i){if((0,u.$c)(t,this.DANGER_COMMAND)&&(t="rickroll"),"\u5e2e\u52a9"==t&&(t="help"),!this[t])return`"${t}"\u6307\u4ee4\u65e0\u6548\uff0c\u8bf7\u68c0\u67e5\u8f93\u5165\uff0c\u6216\u8f93\u5165 help terminal \u67e5\u770b\u5e2e\u52a9\u624b\u518c`;(!i||!i.length)&&(i=[""]);let r=[];for(let p=0;p<i.length;p++){let h=this[t](i[p]);if("FAIL"==h.status)return h.msg||"";h.msg&&r.push(h.msg)}return r.join(" | ")}help(t){return this.EAS.launch("help",{category:t}),{status:"SUCCESS"}}run(t){return t?this.EAS.apps[t]?(this.EAS.launch(t),{status:"SUCCESS"}):{status:"FAIL",msg:`Key\u4e3a"${t}"\u7684App\u4e0d\u5b58\u5728`}:{status:"FAIL",msg:"\u8bf7\u8f93\u5165App Key\uff0c\u5982 run setting"}}ipconfig(){return{status:"SUCCESS",msg:`\u672c\u673aIP\uff1a${this.userSrv.userInfo.ip}`}}time(){return{status:"SUCCESS",msg:`\u5f53\u524d\u65f6\u95f4\uff1a${this.timeSrv.current}`}}date(){return this.time()}exit(){return(0,u.gw)(()=>{this.EAS.closeApp("terminal")},1e3),{status:"SUCCESS",msg:"\u6b63\u5728\u5173\u95ed\u7ec8\u7aef"}}version(){return{status:"SUCCESS",msg:`\u5f53\u524d\u7cfb\u7edf\u7248\u672c\uff1a${this.configSrv.VERSION}`}}tasklist(){return this.EAS.launch("runningApps"),{status:"SUCCESS"}}control(){return this.EAS.launch("setting"),{status:"SUCCESS"}}net(t){return"user"===t&&this.EAS.launch("setting",{activeSettingKey:"account"}),{status:"SUCCESS"}}rickroll(){let t="Ah shit here we go again...";return this.toastSrv.info(t),(0,u.gw)(()=>{this.EAS.launch("hydrogenBrowser",{src:"https://www.bilibili.com/video/BV1GJ411x7h7"})},2e3),{status:"SUCCESS",msg:t}}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(c.y),n.LFG(S.S),n.LFG(g.K),n.LFG(f.O),n.LFG(m.E))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var A=s(2485),d=s(6895),C=s(8805),E=s(1656);const T=["typingInput"];function w(e,l){1&e&&(n._UZ(0,"div",8),n.ALo(1,"safeHtml")),2&e&&n.Q6J("innerHtml",n.lcZ(1,1,l.$implicit),n.oJD)}let M=(()=>{class e{constructor(t,i,r,p,o){this.EAS=t,this.terminalAppSrv=i,this.userSrv=r,this.configSrv=p,this.EMS=o,this.menu=[{name:"\u5e2e\u52a9",children:[{name:"\u7ec8\u7aef\u6307\u4ee4\u624b\u518c",click:()=>{this.help()}}]}],this.titleBarConfig={showBorder:!1,color:"white",background:"black"},this.upDownCurrent=this.terminalAppSrv.typingHistory.length-1,this.output=[],this.EAS.setAppActionBarMenu("terminal",this.menu)}ngOnInit(){this.init()}init(){this.output=[`Ethan Desktop ${this.configSrv.VERSION}<br/>\u8bf7\u52ff\u8f93\u5165\u5371\u9669\u6307\u4ee4\uff0c\u8c22\u8c22\u5408\u4f5c<br/>Please do not enter dangerous commands, thank you`],this.typing=""}help(){this.EAS.launch("help",{category:"terminal"})}onKeydown(t){if(this.typing=t.target.textContent,"Enter"==t.key&&((0,u.gw)(()=>{this.typingInput.nativeElement.innerHTML=""}),(0,u.QF)(this.typing))){if(this.terminalAppSrv.pushHistory(this.typing),this.upDownCurrent=this.terminalAppSrv.typingHistory.length-1,"cls"==this.typing)return void this.init();let r=this.typing.split(" "),p=r[0];r.splice(0,1),this.output.push(`${this.userSrv.userInfo.name}>${this.typing}<br/>${this.terminalAppSrv.start(p,r)}`),this.typing=""}const i=this.terminalAppSrv.typingHistory;if("ArrowDown"==t.key){if(this.upDownCurrent==i.length-1)return;this.typing=i[++this.upDownCurrent],this.typingInput.nativeElement.innerHTML=this.typing}if("ArrowUp"==t.key){if(this.upDownCurrent==this.terminalAppSrv.typingHistory.length-1&&this.typing!=i[this.upDownCurrent])return this.typing=i[this.upDownCurrent],void(this.typingInput.nativeElement.innerHTML=this.typing);if(1==this.upDownCurrent)return;this.typing=i[--this.upDownCurrent],this.typingInput.nativeElement.innerHTML=this.typing}}onMousedown(t){2==t.button&&this.EMS.create({menu:[{name:"\u6e05\u7a7a\u8f93\u51fa",click:()=>{this.init()}},{name:"\u6e05\u7a7a\u5386\u53f2\u8bb0\u5f55",click:()=>{this.upDownCurrent=this.terminalAppSrv.typingHistory.length-1,this.terminalAppSrv.clearHistory()}}]},[t.x,t.y])}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(c.y),n.Y36(v),n.Y36(g.K),n.Y36(m.E),n.Y36(A.d))},e.\u0275cmp=n.Xpm({type:e,selectors:[["ng-component"]],viewQuery:function(t,i){if(1&t&&n.Gf(T,5),2&t){let r;n.iGM(r=n.CRH())&&(i.typingInput=r.first)}},decls:9,vars:3,consts:[[3,"titleBarConfig"],[1,"terminal","full-parent-scroll","p-md",3,"click","mouseup"],[1,"output-block"],["class","output-line mb-md",3,"innerHtml",4,"ngFor","ngForOf"],[1,"typing-block","flex-row"],[1,"typing-user"],["contenteditable","true",1,"typing-input",3,"keydown"],["typingInput",""],[1,"output-line","mb-md",3,"innerHtml"]],template:function(t,i){if(1&t){const r=n.EpF();n.TgZ(0,"e-app",0)(1,"div",1),n.NdJ("click",function(){n.CHM(r);const o=n.MAs(8);return n.KtG(o.focus())})("mouseup",function(o){return i.onMousedown(o)}),n.TgZ(2,"div",2),n.YNc(3,w,2,3,"div",3),n.qZA(),n.TgZ(4,"div",4)(5,"div",5),n._uU(6),n.qZA(),n.TgZ(7,"div",6,7),n.NdJ("keydown",function(o){return i.onKeydown(o)}),n.qZA()()()()}2&t&&(n.Q6J("titleBarConfig",i.titleBarConfig),n.xp6(3),n.Q6J("ngForOf",i.output),n.xp6(3),n.hij("",i.userSrv.userInfo.name,">"))},dependencies:[d.sg,C.T,E.z],styles:[".terminal[_ngcontent-%COMP%]{background-color:#000}.terminal[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;font-size:14px;font-weight:400;word-break:break-all}.terminal[_ngcontent-%COMP%]   .typing-block[_ngcontent-%COMP%]   .typing-user[_ngcontent-%COMP%]{flex-shrink:0}.terminal[_ngcontent-%COMP%]   .typing-block[_ngcontent-%COMP%]   .typing-input[_ngcontent-%COMP%]{width:100%;height:100%}"]}),e})(),H=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[y.m]}),e})()}}]);